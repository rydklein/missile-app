generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  device_token  String         @unique
  name          String?
  game          Game?          @relation(fields: [gameId], references: [id])
  gameId        Int?
  ownedObjects  Object[]       @relation("UserObjects")
  missileRanges MissileRange[] // Relation to pivot table
}

model Game {
  id      Int      @id @default(autoincrement())
  users   User[]
  objects Object[]
}

model Object {
  id            Int            @id @default(autoincrement())
  lat           Float
  long          Float
  type          String
  launched      Boolean        @default(false)
  owner         User           @relation("UserObjects", fields: [ownerId], references: [id])
  ownerId       Int
  game          Game           @relation(fields: [gameId], references: [id])
  gameId        Int
  missileRanges MissileRange[]
}

// Pivot table between User and Object (Missiles)
model MissileRange {
  id        Int     @id @default(autoincrement())
  user      User    @relation(fields: [userId], references: [id])
  userId    Int
  missile   Object  @relation(fields: [missileId], references: [id])
  missileId Int
  inRange   Boolean // Boolean column indicating if the user is in range of the missile

  @@unique([userId, missileId]) // Ensure each user-missile pair is unique
}
